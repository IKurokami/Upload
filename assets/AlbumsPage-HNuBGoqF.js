import{c as H,R as K,j as e,a as W,r as l,i as X,h as S,D as F,k as P,B as u,l as I,m as g,L as Y}from"./index-CfufUkBK.js";import{C as p,b as N,c as w,e as R,a as b,d as L}from"./card-D8P_ZP09.js";import{I as V}from"./input-vYUD2rv5.js";import{S as C,a as Z}from"./scroll-area-BV4w0xMt.js";import{o as ee,r as se,d as ae}from"./db-CRqWljtf.js";import{A as le}from"./x-C-MwQodz.js";import{B as T}from"./badge-DsDvSvRI.js";import{u as te,L as re,D as ne,a as oe,b as ie,c as ce,d as de}from"./dialog-DV_UOnL9.js";import{T as k}from"./trash-2-Dt93xzKL.js";import{E}from"./eye-B03KZuq5.js";import{A as me,a as xe,b as he,c as ue,d as fe,e as je,f as ge,g as pe}from"./alert-dialog-yE2fOWoX.js";import{U as Ne}from"./upload-CBkNcMfp.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],z=H("EllipsisVertical",we);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],ve=H("Search",be),O=K.forwardRef(({children:s,className:t,...o},r)=>e.jsxs("button",{ref:r,className:W("group relative w-auto cursor-pointer overflow-hidden rounded-full border bg-background p-2 px-6 text-center font-semibold",t),...o,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary transition-all duration-300 group-hover:scale-[100.8]"}),e.jsx("span",{className:"inline-block transition-all duration-300 group-hover:translate-x-12 group-hover:opacity-0",children:s})]}),e.jsxs("div",{className:"absolute top-0 z-10 flex h-full w-full translate-x-12 items-center justify-center gap-2 text-primary-foreground opacity-0 transition-all duration-300 group-hover:-translate-x-5 group-hover:opacity-100",children:[e.jsx("span",{children:s}),e.jsx(le,{})]})]}));O.displayName="InteractiveHoverButton";const ye=({album:s,onRename:t,onDelete:o})=>{const r=l.useRef(null),[i,d]=l.useState(!1),[c,m]=l.useState(null),x=X(),h=te({onLongPress:()=>{r.current&&(m(r.current.getBoundingClientRect()),d(!0))},delay:500}),y=[{label:"View Album",icon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>x(`/albums/${s.id}`)},{label:"Rename",icon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>t(s.id)},{label:"Delete",icon:e.jsx(k,{className:"w-4 h-4"}),onClick:()=>o(s.id),destructive:!0}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative group h-full",ref:r,...h,style:{touchAction:"manipulation"},children:e.jsxs(p,{className:"flex flex-col h-full",children:[e.jsx(N,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(w,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(R,{children:["Created at: ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(b,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(T,{variant:"secondary",className:"mr-1",children:s.imageUrls.length})," ","images"]})}),e.jsxs(L,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(S,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(O,{className:"w-full",children:"View Album"})}),e.jsxs(F,{children:[e.jsx(P,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs(I,{align:"end",children:[e.jsxs(g,{onClick:()=>t(s.id),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(g,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})}),i&&e.jsx(re,{rect:c,actions:y,onClose:()=>d(!1),renderHighlighted:()=>e.jsx("div",{style:{width:c==null?void 0:c.width,height:c==null?void 0:c.height,borderRadius:12,boxShadow:"0 0 0 4px rgba(59,130,246,0.25)",border:"2px solid #3b82f6",background:"#fff",overflow:"hidden",pointerEvents:"auto"},children:e.jsxs(p,{className:"flex flex-col h-full",children:[e.jsx(N,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(w,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(R,{children:["Created at:"," ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(b,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(T,{variant:"secondary",className:"mr-1",children:s.imageUrls.length})," ","images"]})}),e.jsxs(L,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(S,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(O,{className:"w-full",children:"View Album"})}),e.jsxs(F,{children:[e.jsx(P,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs(I,{align:"end",children:[e.jsxs(g,{onClick:()=>t(s.id),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(g,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})})})]})},De=({isOpen:s,onClose:t,onDelete:o})=>e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(xe,{children:[e.jsxs(he,{children:[e.jsx(ue,{children:"Are you sure?"}),e.jsx(fe,{children:"This action cannot be undone. This will permanently delete the album and all its data."})]}),e.jsxs(je,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(pe,{onClick:o,children:"Delete"})]})]})}),Ae=({isOpen:s,onClose:t,albumName:o,onRename:r,setAlbumName:i})=>e.jsx(ne,{open:s,onOpenChange:t,children:e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsx(ce,{children:"Rename Album"})}),e.jsx("div",{className:"py-4",children:e.jsx(V,{value:o,onChange:d=>i(d.target.value),placeholder:"Enter new album name"})}),e.jsxs(de,{children:[e.jsx(u,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(u,{onClick:r,children:"Save"})]})]})}),He=()=>{const[s,t]=l.useState([]),[o,r]=l.useState(!0),[i,d]=l.useState(null),[c,m]=l.useState(!1),[x,v]=l.useState(""),[h,y]=l.useState(""),[B,U]=l.useState([]),D=async()=>{r(!0);try{const A=(await ee()).transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();A.onsuccess=()=>{const J=A.result||[];t(J),r(!1)},A.onerror=()=>{console.error("Error loading albums from IndexedDB"),r(!1),alert("Failed to load albums.  Check the console for details.")}}catch(a){console.error("IndexedDB error:",a),alert("Failed to access albums database.  Check the console for details."),r(!1)}};l.useEffect(()=>{D()},[]),l.useEffect(()=>{const a=s.filter(n=>n.albumName.toLowerCase().includes(h.toLowerCase())).sort((n,j)=>new Date(j.createdAt).getTime()-new Date(n.createdAt).getTime());U(a)},[h,s]);const q=a=>{const n=s.find(j=>j.id===a);n&&(v(n.albumName),d(a),m(!0))},M=a=>{d(a),f(!0)},[_,f]=l.useState(!1),$=async()=>{if(i!==null)try{await ae(i),await D(),f(!1)}catch(a){console.error("Error deleting album:",a),alert("Failed to delete album. Please check the console for details."),f(!1)}},Q=async()=>{if(i===null||!x.trim())return;if(s.some(n=>n.albumName.toLowerCase()===x.toLowerCase()&&n.id!==i)){alert("Album name already exists. Please choose a different name.");return}try{await se(i,x),await D(),m(!1)}catch(n){console.error("Error renaming album:",n),alert("Failed to rename album. Please check the console for details."),m(!1)}},G=a=>{y(a.target.value)};return o?e.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:e.jsxs(p,{children:[e.jsx(N,{children:e.jsxs(w,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(E,{size:24}),"Albums"]})}),e.jsxs(b,{className:"p-4 flex justify-center items-center",children:[e.jsx(Y,{className:"h-6 w-6 animate-spin mr-2"})," Loading albums..."]})]})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-8xl",children:[e.jsxs(p,{children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(w,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(E,{size:24}),"Albums"]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{type:"text",placeholder:"Search albums...",value:h,onChange:G,className:"pr-10"}),e.jsx(ve,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})]}),e.jsx(R,{children:"View and manage your saved albums."})]}),e.jsx(b,{className:"p-4",children:e.jsx(Z,{className:"w-full h-[600px] rounded-md",children:e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 grid-flow-row auto-rows-fr",children:B.length>0?B.map(a=>e.jsx(ye,{album:a,onRename:q,onDelete:M},a.id)):e.jsx("div",{className:"col-span-full text-center py-8",children:"No matching albums found."})})})}),e.jsx(L,{className:"p-4 border-t",children:e.jsx(S,{to:"/upload",children:e.jsxs(u,{variant:"outline",children:[e.jsx(Ne,{size:16,className:"mr-2"}),"Back to Uploader"]})})})]}),e.jsx(Ae,{isOpen:c,onClose:()=>m(!1),albumName:x,onRename:Q,setAlbumName:v}),e.jsx(De,{isOpen:_,onClose:()=>f(!1),onDelete:$})]})};export{He as default};
