import{c as F}from"./index-BsXWtyDC.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],I=F("Upload",g),l={editor:{name:"htmlEditorDB",version:1,stores:{htmlFiles:{keyPath:"id",autoIncrement:!0}}},ocr:{name:"ocrTool",version:1}},p=(t,r,s)=>new Promise((i,e)=>{const o=indexedDB.open(t,r);o.onupgradeneeded=n=>{const a=n.target.result;s(a)},o.onsuccess=n=>{i(n.target.result)},o.onerror=n=>{console.error("IndexedDB error:",n.target.error),e(n.target.error)}}),u=()=>p(l.editor.name,l.editor.version,t=>{t.objectStoreNames.contains("htmlFiles")||t.createObjectStore("htmlFiles",l.editor.stores.htmlFiles)}),f=()=>p(l.ocr.name,l.ocr.version,t=>{t.objectStoreNames.contains("config")||t.createObjectStore("config")}),T=async t=>{try{const r=await u();w(r,t)}catch(r){console.error("Failed to initialize database:",r),t([])}},w=(t,r)=>{const e=t.transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();e.onsuccess=()=>{r(e.result)},e.onerror=()=>{console.error("Failed to load files from IndexedDB:",e.error),r([])}},A=async(t,r,s,i,e,o,n)=>{e(!0);try{const a=await u(),d=a.transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles"),h=s==="chapter"?`${r} - ${t}`:t;if((await new Promise((b,D)=>{const m=d.getAll();m.onsuccess=()=>b(m.result),m.onerror=()=>D(m.error)})).some(b=>b.albumName===h)){e(!1),o({type:"error",text:"Album name already exists. Please choose a different name."}),setTimeout(()=>o(null),3e3);return}const x={albumName:h,imageUrls:i,createdAt:new Date().toISOString()},y=d.add(x);y.onsuccess=()=>{e(!1),o({type:"success",text:"Album saved successfully!"}),w(a,n),setTimeout(()=>o(null),3e3)},y.onerror=()=>{e(!1),o({type:"error",text:"Failed to save album."}),setTimeout(()=>o(null),3e3)}}catch(a){console.error("IndexedDB operation failed:",a),e(!1),o({type:"error",text:"IndexedDB operation failed."}),setTimeout(()=>o(null),3e3)}},P=async t=>{try{const e=(await f()).transaction(["config"],"readonly").objectStore("config").get(t);return new Promise((o,n)=>{e.onsuccess=()=>o(e.result),e.onerror=()=>n(e.error)})}catch(r){return console.error("Failed to get data from IndexedDB:",r),null}},U=async(t,r)=>{try{const o=(await f()).transaction(["config"],"readwrite").objectStore("config").put(r,t);return new Promise((n,a)=>{o.onsuccess=()=>n(),o.onerror=()=>a(o.error)})}catch(s){throw console.error("Failed to save data to IndexedDB:",s),s}},q=async t=>{try{const e=(await u()).transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles").delete(t);return new Promise((o,n)=>{e.onsuccess=()=>o(),e.onerror=()=>n(e.error)})}catch(r){throw console.error("Failed to delete album from IndexedDB:",r),r}},O=async(t,r)=>{try{const e=(await u()).transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles"),o=await new Promise((n,a)=>{const c=e.get(t);c.onsuccess=()=>n(c.result),c.onerror=()=>a(c.error)});if(!o)throw new Error("Album not found");return o.albumName=r,new Promise((n,a)=>{const c=e.put(o);c.onsuccess=()=>n(),c.onerror=()=>a(c.error)})}catch(s){throw console.error("Failed to rename album in IndexedDB:",s),s}},N=(t,r,s,i)=>{const e=t.length>0?t.map(d=>`<img src="${d}" alt="" ${s?'loading="lazy"':""}>`).join(`
`):r,o=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${i}</title>
  <style>
    body { background: #f2f2f2; padding: 20px; display: flex; flex-direction: column; align-items: center; }
    img { max-width: 100%; height: auto; object-fit: contain; object-position: top center;}
  </style>
</head>
<body class="container">
  ${e}
</body>
</html>`,n=new Blob([o],{type:"text/html"}),a=URL.createObjectURL(n),c=document.createElement("a");c.href=a,c.download=i,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(a)},100)};export{I as U,P as a,q as d,N as g,T as i,u as o,O as r,U as s,A as u};
