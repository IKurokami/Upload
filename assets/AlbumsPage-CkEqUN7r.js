import{c as H,R as X,j as e,a as Y,r as l,m as Z,l as E,D as B,n as P,B as b,o as q,p as w,L as ee,q as se,t as p,s as ae,v as te}from"./index-ur9zFp39.js";import{C as v,b as y,c as D,e as L,a as A,d as F}from"./card-Dvjo2Szc.js";import{I as V}from"./input-IDa1mvQU.js";import{S as le}from"./scroll-area-Bym5PYyh.js";import{A as re,D as ne,a as oe,b as ie,c as ce,d as de}from"./dialog-CJXk8rYc.js";import{B as U}from"./badge-6Ehp9JXy.js";import{u as me,L as ue}from"./LongPressOverlay-CEXiwTSP.js";import{S as k}from"./square-pen-CmIVmI_e.js";import{T as R}from"./trash-2-CaWUH657.js";import{E as T}from"./eye-ATs_9VP5.js";import{A as xe,a as he,b as fe,c as pe,d as je,e as ge,f as be,g as Ne}from"./alert-dialog-DNFCCqew.js";import{U as we}from"./upload-DH37QyE6.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],z=H("EllipsisVertical",ve);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],De=H("Search",ye),I=X.forwardRef(({children:s,className:n,...o},r)=>e.jsxs("button",{ref:r,className:Y("group relative w-auto cursor-pointer overflow-hidden rounded-full border bg-background p-2 px-6 text-center font-semibold",n),...o,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary transition-all duration-300 group-hover:scale-[100.8]"}),e.jsx("span",{className:"inline-block transition-all duration-300 group-hover:translate-x-12 group-hover:opacity-0",children:s})]}),e.jsxs("div",{className:"absolute top-0 z-10 flex h-full w-full translate-x-12 items-center justify-center gap-2 text-primary-foreground opacity-0 transition-all duration-300 group-hover:-translate-x-5 group-hover:opacity-100",children:[e.jsx("span",{children:s}),e.jsx(re,{})]})]}));I.displayName="InteractiveHoverButton";const Ae=({album:s,onRename:n,onDelete:o})=>{const r=l.useRef(null),[d,c]=l.useState(!1),[i,u]=l.useState(null),x=Z(),a=me({onLongPress:()=>{r.current&&(u(r.current.getBoundingClientRect()),c(!0))},delay:500}),g=[{label:"View Album",icon:e.jsx(T,{className:"w-4 h-4"}),onClick:()=>x(`/albums/${s.id}`)},{label:"Rename",icon:e.jsx(k,{className:"w-4 h-4"}),onClick:()=>n(s.id)},{label:"Delete",icon:e.jsx(R,{className:"w-4 h-4"}),onClick:()=>o(s.id),destructive:!0}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative group h-full",ref:r,...a,style:{touchAction:"manipulation"},children:e.jsxs(v,{className:"flex flex-col h-full",children:[e.jsx(y,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(D,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(L,{children:["Created at: ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(A,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(U,{variant:"secondary",className:"mr-1",children:s.imageUrls.length})," ","images"]})}),e.jsxs(F,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(E,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(I,{className:"w-full",children:"View Album"})}),e.jsxs(B,{children:[e.jsx(P,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs(q,{align:"end",children:[e.jsxs(w,{onClick:()=>n(s.id),children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(w,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})}),d&&e.jsx(ue,{rect:i,actions:g,onClose:()=>c(!1),renderHighlighted:()=>e.jsx("div",{style:{width:i==null?void 0:i.width,height:i==null?void 0:i.height,borderRadius:12,boxShadow:"0 0 0 4px rgba(59,130,246,0.25)",border:"2px solid #3b82f6",background:"#fff",overflow:"hidden",pointerEvents:"auto"},children:e.jsxs(v,{className:"flex flex-col h-full",children:[e.jsx(y,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(D,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(L,{children:["Created at:"," ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(A,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(U,{variant:"secondary",className:"mr-1",children:s.imageUrls.length})," ","images"]})}),e.jsxs(F,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(E,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(I,{className:"w-full",children:"View Album"})}),e.jsxs(B,{children:[e.jsx(P,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs(q,{align:"end",children:[e.jsxs(w,{onClick:()=>n(s.id),children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(w,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})})})]})},Ce=({isOpen:s,onClose:n,onDelete:o})=>e.jsx(xe,{open:s,onOpenChange:n,children:e.jsxs(he,{children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Are you sure?"}),e.jsx(je,{children:"This action cannot be undone. This will permanently delete the album and all its data."})]}),e.jsxs(ge,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Ne,{onClick:o,children:"Delete"})]})]})}),Se=({isOpen:s,onClose:n,albumName:o,onRename:r,setAlbumName:d})=>{const c=l.useRef(null),i=l.useRef(null);l.useEffect(()=>{if(s&&c.current){const a=setTimeout(()=>{var g;(g=c.current)==null||g.focus()},100);return()=>clearTimeout(a)}},[s]);const u=a=>{a||requestAnimationFrame(()=>{n()})},x=a=>{d(a.target.value)},j=a=>{a.preventDefault(),a.stopPropagation(),requestAnimationFrame(r)};return e.jsx(ne,{open:s,onOpenChange:u,modal:!0,children:e.jsxs(oe,{className:"sm:max-w-[425px]",onInteractOutside:a=>a.preventDefault(),onEscapeKeyDown:a=>{a.preventDefault(),u(!1)},children:[e.jsx(ie,{children:e.jsx(ce,{children:"Rename Album"})}),e.jsxs("form",{ref:i,onSubmit:j,children:[e.jsx("div",{className:"py-4",children:e.jsx(V,{ref:c,value:o,onChange:x,placeholder:"Enter new album name",name:"albumName",autoComplete:"off"})}),e.jsxs(de,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>u(!1),tabIndex:0,children:"Cancel"}),e.jsx(b,{type:"submit",tabIndex:0,children:"Save"})]})]})]})})},ze=()=>{const[s,n]=l.useState([]),[o,r]=l.useState(!0),[d,c]=l.useState(null),[i,u]=l.useState(!1),[x,j]=l.useState(""),[a,g]=l.useState(""),[O,$]=l.useState([]),C=async()=>{r(!0);try{const h=(await se()).transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();h.onsuccess=()=>{const W=h.result||[];n(W),r(!1)},h.onerror=()=>{console.error("Error loading albums from IndexedDB"),r(!1),p.error("Failed to load albums",{description:"Check the console for details."})}}catch(t){console.error("IndexedDB error:",t),p.error("Failed to access albums database",{description:"Check the console for details."}),r(!1)}};l.useEffect(()=>{C()},[]),l.useEffect(()=>{const t=s.filter(m=>m.albumName.toLowerCase().includes(a.toLowerCase())).sort((m,f)=>new Date(f.createdAt).getTime()-new Date(m.createdAt).getTime());$(t)},[a,s]);const M=t=>{const m=s.find(f=>f.id===t);m&&(j(m.albumName),c(t),setTimeout(()=>{u(!0)},0))},_=t=>{c(t),N(!0)},[Q,N]=l.useState(!1),K=async()=>{if(d!==null)try{await te(d),await C(),N(!1),p.success("Album deleted successfully")}catch(t){console.error("Error deleting album:",t),p.error("Failed to delete album",{description:"Please check the console for details."}),N(!1)}},S=()=>{u(!1),requestAnimationFrame(()=>{c(null),j("")})},G=()=>{requestAnimationFrame(async()=>{if(d===null||!x.trim()){S();return}if(s.some(h=>h.albumName.toLowerCase()===x.toLowerCase()&&h.id!==d)){p.error("Album name already exists",{description:"Please choose a different name."});return}const m=d,f=x;S();try{await ae(m,f),await C(),p.success(`Album renamed to "${f}"`)}catch(h){console.error("Error renaming album:",h),p.error("Failed to rename album",{description:"Please check the console for details."})}})},J=t=>{g(t.target.value)};return o?e.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(D,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{size:24}),"Albums"]})}),e.jsxs(A,{className:"p-4 flex justify-center items-center",children:[e.jsx(ee,{className:"h-6 w-6 animate-spin mr-2"})," Loading albums..."]})]})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-8xl",children:[e.jsxs(v,{children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(D,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{size:24}),"Albums"]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{type:"text",placeholder:"Search albums...",value:a,onChange:J,className:"pr-10"}),e.jsx(De,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})]}),e.jsx(L,{children:"View and manage your saved albums."})]}),e.jsx(A,{className:"p-4",children:e.jsx(le,{className:"w-full h-[600px] rounded-md",children:e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 grid-flow-row auto-rows-fr",children:O.length>0?O.map(t=>e.jsx(Ae,{album:t,onRename:M,onDelete:_},t.id)):e.jsx("div",{className:"col-span-full text-center py-8",children:"No matching albums found."})})})}),e.jsx(F,{className:"p-4 border-t",children:e.jsx(E,{to:"/upload",children:e.jsxs(b,{variant:"outline",children:[e.jsx(we,{size:16,className:"mr-2"}),"Back to Uploader"]})})})]}),e.jsx(Se,{isOpen:i,onClose:S,albumName:x,onRename:G,setAlbumName:j}),e.jsx(Ce,{isOpen:Q,onClose:()=>N(!1),onDelete:K})]})};export{ze as default};
