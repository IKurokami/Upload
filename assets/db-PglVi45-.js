import{R as v,u as O,j as w,S as L,r as h}from"./index-CSDmaBWR.js";import{c as M,h as Z,P as U,a as T,e as ee,u as te,d as oe}from"./index-DVZdnhb6.js";function re(e){const t=e+"CollectionProvider",[n,s]=M(t),[r,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),a=b=>{const{scope:c,children:m}=b,f=v.useRef(null),d=v.useRef(new Map).current;return w.jsx(r,{scope:c,itemMap:d,collectionRef:f,children:m})};a.displayName=t;const l=e+"CollectionSlot",i=v.forwardRef((b,c)=>{const{scope:m,children:f}=b,d=o(l,m),p=O(c,d.collectionRef);return w.jsx(L,{ref:p,children:f})});i.displayName=l;const u=e+"CollectionItemSlot",F="data-radix-collection-item",R=v.forwardRef((b,c)=>{const{scope:m,children:f,...d}=b,p=v.useRef(null),x=O(c,p),C=o(u,m);return v.useEffect(()=>(C.itemMap.set(p,{ref:p,...d}),()=>void C.itemMap.delete(p))),w.jsx(L,{[F]:"",ref:x,children:f})});R.displayName=u;function g(b){const c=o(e+"CollectionConsumer",b);return v.useCallback(()=>{const f=c.collectionRef.current;if(!f)return[];const d=Array.from(f.querySelectorAll(`[${F}]`));return Array.from(c.itemMap.values()).sort((C,E)=>d.indexOf(C.ref.current)-d.indexOf(E.ref.current))},[c.collectionRef,c.itemMap])}return[{Provider:a,Slot:i,ItemSlot:R},g,s]}var j="rovingFocusGroup.onEntryFocus",ne={bubbles:!1,cancelable:!0},S="RovingFocusGroup",[_,G,se]=re(S),[ce,he]=M(S,[se]),[ae,ie]=ce(S),k=h.forwardRef((e,t)=>w.jsx(_.Provider,{scope:e.__scopeRovingFocusGroup,children:w.jsx(_.Slot,{scope:e.__scopeRovingFocusGroup,children:w.jsx(le,{...e,ref:t})})}));k.displayName=S;var le=h.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:r=!1,dir:o,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:i,onEntryFocus:u,preventScrollOnEntryFocus:F=!1,...R}=e,g=h.useRef(null),b=O(t,g),c=ee(o),[m=null,f]=te({prop:a,defaultProp:l,onChange:i}),[d,p]=h.useState(!1),x=oe(u),C=G(n),E=h.useRef(!1),[V,N]=h.useState(0);return h.useEffect(()=>{const I=g.current;if(I)return I.addEventListener(j,x),()=>I.removeEventListener(j,x)},[x]),w.jsx(ae,{scope:n,orientation:s,dir:c,loop:r,currentTabStopId:m,onItemFocus:h.useCallback(I=>f(I),[f]),onItemShiftTab:h.useCallback(()=>p(!0),[]),onFocusableItemAdd:h.useCallback(()=>N(I=>I+1),[]),onFocusableItemRemove:h.useCallback(()=>N(I=>I-1),[]),children:w.jsx(U.div,{tabIndex:d||V===0?-1:0,"data-orientation":s,...R,ref:b,style:{outline:"none",...e.style},onMouseDown:T(e.onMouseDown,()=>{E.current=!0}),onFocus:T(e.onFocus,I=>{const J=!E.current;if(I.target===I.currentTarget&&J&&!d){const B=new CustomEvent(j,ne);if(I.currentTarget.dispatchEvent(B),!B.defaultPrevented){const P=C().filter(y=>y.focusable),Q=P.find(y=>y.active),W=P.find(y=>y.id===m),X=[Q,W,...P].filter(Boolean).map(y=>y.ref.current);$(X,F)}}E.current=!1}),onBlur:T(e.onBlur,()=>p(!1))})})}),q="RovingFocusGroupItem",K=h.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:r=!1,tabStopId:o,...a}=e,l=Z(),i=o||l,u=ie(q,n),F=u.currentTabStopId===i,R=G(n),{onFocusableItemAdd:g,onFocusableItemRemove:b}=u;return h.useEffect(()=>{if(s)return g(),()=>b()},[s,g,b]),w.jsx(_.ItemSlot,{scope:n,id:i,focusable:s,active:r,children:w.jsx(U.span,{tabIndex:F?0:-1,"data-orientation":u.orientation,...a,ref:t,onMouseDown:T(e.onMouseDown,c=>{s?u.onItemFocus(i):c.preventDefault()}),onFocus:T(e.onFocus,()=>u.onItemFocus(i)),onKeyDown:T(e.onKeyDown,c=>{if(c.key==="Tab"&&c.shiftKey){u.onItemShiftTab();return}if(c.target!==c.currentTarget)return;const m=me(c,u.orientation,u.dir);if(m!==void 0){if(c.metaKey||c.ctrlKey||c.altKey||c.shiftKey)return;c.preventDefault();let d=R().filter(p=>p.focusable).map(p=>p.ref.current);if(m==="last")d.reverse();else if(m==="prev"||m==="next"){m==="prev"&&d.reverse();const p=d.indexOf(c.currentTarget);d=u.loop?fe(d,p+1):d.slice(p+1)}setTimeout(()=>$(d))}})})})});K.displayName=q;var ue={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function de(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function me(e,t,n){const s=de(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return ue[s]}function $(e,t=!1){const n=document.activeElement;for(const s of e)if(s===n||(s.focus({preventScroll:t}),document.activeElement!==n))return}function fe(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var we=k,Fe=K;const D={editor:{name:"htmlEditorDB",version:1,stores:{htmlFiles:{keyPath:"id",autoIncrement:!0}}},ocr:{name:"ocrTool",version:1}},H=(e,t,n)=>new Promise((s,r)=>{const o=indexedDB.open(e,t);o.onupgradeneeded=a=>{const l=a.target.result;n(l)},o.onsuccess=a=>{s(a.target.result)},o.onerror=a=>{console.error("IndexedDB error:",a.target.error),r(a.target.error)}}),A=()=>H(D.editor.name,D.editor.version,e=>{e.objectStoreNames.contains("htmlFiles")||e.createObjectStore("htmlFiles",D.editor.stores.htmlFiles)}),Y=()=>H(D.ocr.name,D.ocr.version,e=>{e.objectStoreNames.contains("config")||e.createObjectStore("config")}),ge=async e=>{try{const t=await A();z(t,e)}catch(t){console.error("Failed to initialize database:",t),e([])}},z=(e,t)=>{const r=e.transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();r.onsuccess=()=>{t(r.result)},r.onerror=()=>{console.error("Failed to load files from IndexedDB:",r.error),t([])}},Re=async(e,t,n,s,r,o,a)=>{r(!0);try{const l=await A(),u=l.transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles"),F=n==="chapter"?`${t} - ${e}`:e;if((await new Promise((c,m)=>{const f=u.getAll();f.onsuccess=()=>c(f.result),f.onerror=()=>m(f.error)})).some(c=>c.albumName===F)){r(!1),o({type:"error",text:"Album name already exists. Please choose a different name."}),setTimeout(()=>o(null),3e3);return}const g={albumName:F,imageUrls:s,createdAt:new Date().toISOString()},b=u.add(g);b.onsuccess=()=>{r(!1),o({type:"success",text:"Album saved successfully!"}),z(l,a),setTimeout(()=>o(null),3e3)},b.onerror=()=>{r(!1),o({type:"error",text:"Failed to save album."}),setTimeout(()=>o(null),3e3)}}catch(l){console.error("IndexedDB operation failed:",l),r(!1),o({type:"error",text:"IndexedDB operation failed."}),setTimeout(()=>o(null),3e3)}},ye=async e=>{try{const r=(await Y()).transaction(["config"],"readonly").objectStore("config").get(e);return new Promise((o,a)=>{r.onsuccess=()=>o(r.result),r.onerror=()=>a(r.error)})}catch(t){return console.error("Failed to get data from IndexedDB:",t),null}},ve=async(e,t)=>{try{const o=(await Y()).transaction(["config"],"readwrite").objectStore("config").put(t,e);return new Promise((a,l)=>{o.onsuccess=()=>a(),o.onerror=()=>l(o.error)})}catch(n){throw console.error("Failed to save data to IndexedDB:",n),n}},xe=async e=>{try{const r=(await A()).transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles").delete(e);return new Promise((o,a)=>{r.onsuccess=()=>o(),r.onerror=()=>a(r.error)})}catch(t){throw console.error("Failed to delete album from IndexedDB:",t),t}},Ce=async(e,t)=>{try{const r=(await A()).transaction(["htmlFiles"],"readwrite").objectStore("htmlFiles"),o=await new Promise((a,l)=>{const i=r.get(e);i.onsuccess=()=>a(i.result),i.onerror=()=>l(i.error)});if(!o)throw new Error("Album not found");return o.albumName=t,new Promise((a,l)=>{const i=r.put(o);i.onsuccess=()=>a(),i.onerror=()=>l(i.error)})}catch(n){throw console.error("Failed to rename album in IndexedDB:",n),n}},Te=(e,t,n,s)=>{const r=e.length>0?e.map(u=>`<img src="${u}" alt="" ${n?'loading="lazy"':""}>`).join(`
`):t,o=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${s}</title>
  <style>
    body { background: #f2f2f2; padding: 20px; display: flex; flex-direction: column; align-items: center; }
    img { max-width: 100%; height: auto; object-fit: contain; object-position: top center;}
  </style>
</head>
<body class="container">
  ${r}
</body>
</html>`,a=new Blob([o],{type:"text/html"}),l=URL.createObjectURL(a),i=document.createElement("a");i.href=l,i.download=s,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(l)},100)};export{Fe as I,we as R,he as a,ye as b,re as c,xe as d,Te as g,ge as i,A as o,Ce as r,ve as s,Re as u};
