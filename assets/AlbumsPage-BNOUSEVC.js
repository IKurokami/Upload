import{c as C,R as U,j as e,a as V,h as S,D as _,i as Q,B as h,k as $,l as A,r,L as G}from"./index-DvfK4WZD.js";import{C as g,b,c as N,e as k,a as w,d as E}from"./card-CNLP_Yo2.js";import{I as R}from"./input-Dj4JzUv2.js";import{S as J,a as K}from"./scroll-area-CcRfwnFN.js";import{o as W,r as X,d as Y}from"./db-CRqWljtf.js";import{A as Z,D as ee,a as se,b as ae,c as le,d as te}from"./dialog-Bp_AjcRy.js";import{B as re}from"./badge-o17PVQTW.js";import{T as ne}from"./trash-2-CaSNLKhg.js";import{A as oe,a as ie,b as ce,c as de,d as me,e as ue,f as xe,g as he}from"./alert-dialog-CavrKbc9.js";import{E as v}from"./eye-DNGNMixp.js";import{U as fe}from"./upload-gQGdKyI8.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],je=C("EllipsisVertical",pe);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],be=C("Search",ge),B=U.forwardRef(({children:s,className:t,...n},o)=>e.jsxs("button",{ref:o,className:V("group relative w-auto cursor-pointer overflow-hidden rounded-full border bg-background p-2 px-6 text-center font-semibold",t),...n,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary transition-all duration-300 group-hover:scale-[100.8]"}),e.jsx("span",{className:"inline-block transition-all duration-300 group-hover:translate-x-12 group-hover:opacity-0",children:s})]}),e.jsxs("div",{className:"absolute top-0 z-10 flex h-full w-full translate-x-12 items-center justify-center gap-2 text-primary-foreground opacity-0 transition-all duration-300 group-hover:-translate-x-5 group-hover:opacity-100",children:[e.jsx("span",{children:s}),e.jsx(Z,{})]})]}));B.displayName="InteractiveHoverButton";const Ne=({album:s,onRename:t,onDelete:n})=>e.jsx("div",{className:"relative group h-full",children:e.jsxs(g,{className:"flex flex-col h-full",children:[e.jsx(b,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(N,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(k,{children:["Created at: ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(w,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(re,{variant:"secondary",className:"mr-1",children:s.imageUrls.length})," ","images"]})}),e.jsxs(E,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(S,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(B,{className:"w-full",children:"View Album"})}),e.jsxs(_,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs($,{align:"end",children:[e.jsxs(A,{onClick:()=>t(s.id),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(A,{onClick:()=>n(s.id),className:"text-red-600",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})}),we=({isOpen:s,onClose:t,onDelete:n})=>e.jsx(oe,{open:s,onOpenChange:t,children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Are you sure?"}),e.jsx(me,{children:"This action cannot be undone. This will permanently delete the album and all its data."})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:"Cancel"}),e.jsx(he,{onClick:n,children:"Delete"})]})]})}),De=({isOpen:s,onClose:t,albumName:n,onRename:o,setAlbumName:i})=>e.jsx(ee,{open:s,onOpenChange:t,children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(le,{children:"Rename Album"})}),e.jsx("div",{className:"py-4",children:e.jsx(R,{value:n,onChange:c=>i(c.target.value),placeholder:"Enter new album name"})}),e.jsxs(te,{children:[e.jsx(h,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(h,{onClick:o,children:"Save"})]})]})}),Ie=()=>{const[s,t]=r.useState([]),[n,o]=r.useState(!0),[i,c]=r.useState(null),[F,d]=r.useState(!1),[m,D]=r.useState(""),[f,L]=r.useState(""),[y,I]=r.useState([]),p=async()=>{o(!0);try{const j=(await W()).transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();j.onsuccess=()=>{const M=j.result||[];t(M),o(!1)},j.onerror=()=>{console.error("Error loading albums from IndexedDB"),o(!1),alert("Failed to load albums.  Check the console for details.")}}catch(a){console.error("IndexedDB error:",a),alert("Failed to access albums database.  Check the console for details."),o(!1)}};r.useEffect(()=>{p()},[]),r.useEffect(()=>{const a=s.filter(l=>l.albumName.toLowerCase().includes(f.toLowerCase())).sort((l,x)=>new Date(x.createdAt).getTime()-new Date(l.createdAt).getTime());I(a)},[f,s]);const O=a=>{const l=s.find(x=>x.id===a);l&&(D(l.albumName),c(a),d(!0))},T=a=>{c(a),u(!0)},[z,u]=r.useState(!1),H=async()=>{if(i!==null)try{await Y(i),await p(),u(!1)}catch(a){console.error("Error deleting album:",a),alert("Failed to delete album. Please check the console for details."),u(!1)}},P=async()=>{if(i===null||!m.trim())return;if(s.some(l=>l.albumName.toLowerCase()===m.toLowerCase()&&l.id!==i)){alert("Album name already exists. Please choose a different name.");return}try{await X(i,m),await p(),d(!1)}catch(l){console.error("Error renaming album:",l),alert("Failed to rename album. Please check the console for details."),d(!1)}},q=a=>{L(a.target.value)};return n?e.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs(N,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(v,{size:24}),"Albums"]})}),e.jsxs(w,{className:"p-4 flex justify-center items-center",children:[e.jsx(G,{className:"h-6 w-6 animate-spin mr-2"})," Loading albums..."]})]})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-4xl",children:[e.jsxs(g,{children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(v,{size:24}),"Albums"]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{type:"text",placeholder:"Search albums...",value:f,onChange:q,className:"pr-10"}),e.jsx(be,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})]}),e.jsx(k,{children:"View and manage your saved albums."})]}),e.jsx(w,{className:"p-4",children:e.jsx(K,{className:"w-full h-[500px] rounded-md",children:e.jsx("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 grid-flow-row auto-rows-fr",children:y.length>0?y.map(a=>e.jsx(Ne,{album:a,onRename:O,onDelete:T},a.id)):e.jsx("div",{className:"col-span-full text-center py-8",children:"No matching albums found."})})})}),e.jsx(E,{className:"p-4 border-t",children:e.jsx(S,{to:"/upload",children:e.jsxs(h,{variant:"outline",children:[e.jsx(fe,{size:16,className:"mr-2"}),"Back to Uploader"]})})})]}),e.jsx(De,{isOpen:F,onClose:()=>d(!1),albumName:m,onRename:P,setAlbumName:D}),e.jsx(we,{isOpen:z,onClose:()=>u(!1),onDelete:H})]})};export{Ie as default};
