import{c as V,R as X,j as e,a as Y,r as l,o as Z,L as F,D as P,p as q,B as N,q as U,s as y,l as ee,t as se,v as j,w as ae,x as te}from"./index-XpwDNl3j.js";import{C as D,a as C,b as A,c as T,e as S,d as I}from"./card-LkZzq07F.js";import{I as $}from"./input-HKJpS8uj.js";import{S as le}from"./scroll-area-DQk9OGRe.js";import{A as re}from"./arrow-right-BlgZFEui.js";import{B as z}from"./badge-n4fhuCe_.js";import{u as ne,L as oe,D as ie,a as ce,b as de,c as me,d as ue}from"./dialog-Cd4tSwC5.js";import{S as E}from"./square-pen-mUhYNp0m.js";import{T as L}from"./trash-2-RhdtJEnZ.js";import{E as O}from"./eye-BNInK73h.js";import{A as xe,a as he,b as fe,c as pe,d as je,e as ge,f as be,g as Ne}from"./alert-dialog-CUI2ADR5.js";import{U as we}from"./upload-DFDJjmTK.js";import"./index-C1lmyVfY.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],H=V("EllipsisVertical",ve);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],De=V("Search",ye),B=X.forwardRef(({children:s,className:n,...o},r)=>e.jsxs("button",{ref:r,className:Y("group relative w-auto cursor-pointer overflow-hidden rounded-full border bg-background p-2 px-6 text-center font-semibold",n),...o,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary transition-all duration-300 group-hover:scale-[100.8]"}),e.jsx("span",{className:"inline-block transition-all duration-300 group-hover:translate-x-12 group-hover:opacity-0",children:s})]}),e.jsxs("div",{className:"absolute top-0 z-10 flex h-full w-full translate-x-12 items-center justify-center gap-2 text-primary-foreground opacity-0 transition-all duration-300 group-hover:-translate-x-5 group-hover:opacity-100",children:[e.jsx("span",{children:s}),e.jsx(re,{})]})]}));B.displayName="InteractiveHoverButton";const Ce=({album:s,onRename:n,onDelete:o})=>{var f;const r=l.useRef(null),[d,c]=l.useState(!1),[i,u]=l.useState(null),x=Z(),a=ne({onLongPress:()=>{r.current&&(u(r.current.getBoundingClientRect()),c(!0))},delay:500}),b=[{label:"View Album",icon:e.jsx(O,{className:"w-4 h-4"}),onClick:()=>x(`/albums/${s.id}`)},{label:"Rename",icon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>n(s.id)},{label:"Delete",icon:e.jsx(L,{className:"w-4 h-4"}),onClick:()=>o(s.id),destructive:!0}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative group h-full",ref:r,...a,style:{touchAction:"manipulation"},children:e.jsxs(D,{className:"flex flex-col h-full",children:[e.jsx(C,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(A,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(T,{children:["Created at: ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(S,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(z,{variant:"secondary",className:"mr-1",children:(f=s.imageUrls)==null?void 0:f.length})," ","images"]})}),e.jsxs(I,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(F,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(B,{className:"w-full",children:"View Album"})}),e.jsxs(P,{children:[e.jsx(q,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs(U,{align:"end",children:[e.jsxs(y,{onClick:()=>n(s.id),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(y,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})}),d&&e.jsx(oe,{rect:i,actions:b,onClose:()=>c(!1),renderHighlighted:()=>{var w;return e.jsx("div",{style:{width:i==null?void 0:i.width,height:i==null?void 0:i.height,borderRadius:12,boxShadow:"0 0 0 4px rgba(59,130,246,0.25)",border:"2px solid #3b82f6",background:"#fff",overflow:"hidden",pointerEvents:"auto"},children:e.jsxs(D,{className:"flex flex-col h-full",children:[e.jsx(C,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex flex-col w-full overflow-hidden",children:[e.jsx(A,{className:"text-lg truncate w-full",title:s.albumName,children:s.albumName}),e.jsxs(T,{children:["Created at:"," ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(S,{className:"pt-2 flex-grow",children:e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx(z,{variant:"secondary",className:"mr-1",children:(w=s.imageUrls)==null?void 0:w.length})," ","images"]})}),e.jsxs(I,{className:"pt-2 flex justify-between items-center mt-auto",children:[e.jsx(F,{to:`/albums/${s.id}`,className:"flex-1 mr-2",children:e.jsx(B,{className:"w-full",children:"View Album"})}),e.jsxs(P,{children:[e.jsx(q,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs(U,{align:"end",children:[e.jsxs(y,{onClick:()=>n(s.id),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Rename"]}),e.jsxs(y,{onClick:()=>o(s.id),className:"text-red-600",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})})}})]})},Ae=({isOpen:s,onClose:n,onDelete:o})=>e.jsx(xe,{open:s,onOpenChange:n,children:e.jsxs(he,{children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Are you sure?"}),e.jsx(je,{children:"This action cannot be undone. This will permanently delete the album and all its data."})]}),e.jsxs(ge,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Ne,{onClick:o,children:"Delete"})]})]})}),Se=({isOpen:s,onClose:n,albumName:o,onRename:r,setAlbumName:d})=>{const c=l.useRef(null),i=l.useRef(null);l.useEffect(()=>{if(s&&c.current){const a=setTimeout(()=>{var b;(b=c.current)==null||b.focus()},100);return()=>clearTimeout(a)}},[s]);const u=a=>{a||requestAnimationFrame(()=>{n()})},x=a=>{d(a.target.value)},g=a=>{a.preventDefault(),a.stopPropagation(),requestAnimationFrame(r)};return e.jsx(ie,{open:s,onOpenChange:u,modal:!0,children:e.jsxs(ce,{className:"sm:max-w-[425px]",onInteractOutside:a=>a.preventDefault(),onEscapeKeyDown:a=>{a.preventDefault(),u(!1)},children:[e.jsx(de,{children:e.jsx(me,{children:"Rename Album"})}),e.jsxs("form",{ref:i,onSubmit:g,children:[e.jsx("div",{className:"py-4",children:e.jsx($,{ref:c,value:o,onChange:x,placeholder:"Enter new album name",name:"albumName",autoComplete:"off"})}),e.jsxs(ue,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>u(!1),tabIndex:0,children:"Cancel"}),e.jsx(N,{type:"submit",tabIndex:0,children:"Save"})]})]})]})})},He=()=>{const[s,n]=l.useState([]),[o,r]=l.useState(!0),[d,c]=l.useState(null),[i,u]=l.useState(!1),[x,g]=l.useState(""),[a,b]=l.useState(""),[f,w]=l.useState([]),k=async()=>{r(!0);try{const h=(await se()).transaction(["htmlFiles"],"readonly").objectStore("htmlFiles").getAll();h.onsuccess=()=>{const W=h.result||[];n(W),r(!1)},h.onerror=()=>{console.error("Error loading albums from IndexedDB"),r(!1),j.error("Failed to load albums",{description:"Check the console for details."})}}catch(t){console.error("IndexedDB error:",t),j.error("Failed to access albums database",{description:"Check the console for details."}),r(!1)}};l.useEffect(()=>{k()},[]),l.useEffect(()=>{const t=s.filter(m=>m.albumName.toLowerCase().includes(a.toLowerCase())).sort((m,p)=>new Date(p.createdAt).getTime()-new Date(m.createdAt).getTime());w(t)},[a,s]);const M=t=>{const m=s.find(p=>p.id===t);m&&(g(m.albumName),c(t),setTimeout(()=>{u(!0)},0))},_=t=>{c(t),v(!0)},[Q,v]=l.useState(!1),K=async()=>{if(d!==null)try{await te(d),await k(),v(!1),j.success("Album deleted successfully")}catch(t){console.error("Error deleting album:",t),j.error("Failed to delete album",{description:"Please check the console for details."}),v(!1)}},R=()=>{u(!1),requestAnimationFrame(()=>{c(null),g("")})},G=()=>{requestAnimationFrame(async()=>{if(d===null||!x.trim()){R();return}if(s.some(h=>h.albumName.toLowerCase()===x.toLowerCase()&&h.id!==d)){j.error("Album name already exists",{description:"Please choose a different name."});return}const m=d,p=x;R();try{await ae(m,p),await k(),j.success(`Album renamed to "${p}"`)}catch(h){console.error("Error renaming album:",h),j.error("Failed to rename album",{description:"Please check the console for details."})}})},J=t=>{b(t.target.value)};return o?e.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(A,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(O,{size:24}),"Albums"]})}),e.jsxs(S,{className:"p-4 flex justify-center items-center",children:[e.jsx(ee,{className:"h-6 w-6 animate-spin mr-2"})," Loading albums..."]})]})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-8xl",children:[e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(O,{size:24}),"Albums"]}),e.jsxs("div",{className:"relative",children:[e.jsx($,{type:"text",placeholder:"Search albums...",value:a,onChange:J,className:"pr-10"}),e.jsx(De,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})]}),e.jsx(T,{children:"View and manage your saved albums."})]}),e.jsx(S,{className:"p-4",children:e.jsx(le,{className:"w-full h-[600px] rounded-md",children:e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 grid-flow-row auto-rows-fr",children:(f==null?void 0:f.length)>0?f.map(t=>e.jsx(Ce,{album:t,onRename:M,onDelete:_},t.id)):e.jsx("div",{className:"col-span-full text-center py-8",children:"No matching albums found."})})})}),e.jsx(I,{className:"p-4 border-t",children:e.jsx(F,{to:"/Upload/Upload",children:e.jsxs(N,{variant:"outline",children:[e.jsx(we,{size:16,className:"mr-2"}),"Back to Uploader"]})})})]}),e.jsx(Se,{isOpen:i,onClose:R,albumName:x,onRename:G,setAlbumName:g}),e.jsx(Ae,{isOpen:Q,onClose:()=>v(!1),onDelete:K})]})};export{He as default};
